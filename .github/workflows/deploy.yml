name: Deploy Paper Server on AZURE
# This workflow represents a set of basic End-to-End tests
on:
  release:
    types: [published]
  workflow_dispatch:

jobs:
    deploy_pull:
      permissions:
        id-token: write
        contents: read
        actions: read
      runs-on: ubuntu-latest
      steps:
        - name: Checkout
          uses: actions/checkout@v4.1.2
        - name: Transform docker compose to manifest using Kompose
          id: bake
          uses: azure/k8s-bake@v3
          with:
              renderEngine: 'kompose'
              dockerComposeFile: './docker-compose.yml'
              kompose-version: 'latest'
        - name: Azure login
          uses: azure/login@v2
          with:
            client-id: ${{ secrets.AZ_CLIENT_ID }}
            tenant-id: ${{ secrets.AZ_TENANT_ID }}
            subscription-id: ${{ secrets.AZ_SUBSCRIPTION_ID }}
        
        - name: Azure CLI script
          uses: azure/CLI@v1
          with:
            azcliversion: latest
            inlineScript: |
              az account show
    # The KUBECONFIG env var is automatically exported and picked up by kubectl.
        - id: 'get-pods'
          run: 'kubectl get pods'